# GIF Toolkit - Build and Test Guide

## Prerequisites

Make sure you have Rust installed:
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env
```

## Build the Project

```bash
# Debug build
cargo build

# Release build (optimized)
cargo build --release
```

## Generate Test GIFs

```bash
# Run the test GIF generator
cargo run --bin test_gen

# Or use the release binary
./target/release/test_gen
```

This will create the following test GIFs in `tests/fixtures/`:
- `simple.gif` - Simple 2-frame animation (100x100)
- `colorful.gif` - Colorful 10-frame animation (200x200)
- `large.gif` - Large 5-frame animation (800x600)
- `duplicates.gif` - Animation with duplicate frames (150x150)
- `high_fps.gif` - High FPS 30-frame animation (100x100)

## Test the Compress Operation

```bash
# Get info about a test GIF
cargo run --release -- info tests/fixtures/simple.gif

# Compress a GIF to 50% of original size
cargo run --release -- compress tests/fixtures/colorful.gif tests/fixtures/colorful_compressed.gif 50

# Compare file sizes
ls -lh tests/fixtures/colorful.gif tests/fixtures/colorful_compressed.gif
```

## Run Tests

```bash
# Run all tests
cargo test

# Run tests with output
cargo test -- --nocapture

# Run specific test
cargo test test_calculate_frame_difference
```

## Development

```bash
# Check code without building
cargo check

# Format code
cargo fmt

# Run linter
cargo clippy

# Build documentation
cargo doc --open
```

## Project Structure

```
gif-toolkit/
├── Cargo.toml              # Project dependencies
├── src/
│   ├── main.rs             # CLI entry point
│   ├── lib.rs              # Library exports
│   ├── core/
│   │   └── mod.rs          # Core Gif struct with from_file/to_file
│   ├── operations/
│   │   ├── compress.rs     # Compression implementation
│   │   └── mod.rs          # Operations module
│   └── bin/
│       └── test_gen.rs     # Test GIF generator
└── tests/
    └── fixtures/           # Test GIF files (generated by test_gen)
```

## Compression Algorithm

The compression operation uses an iterative approach with the following steps:

1. **Frame Deduplication** (threshold 10) - Removes similar frames
2. **Color Reduction** (128 colors) - Reduces color palette
3. **Lossy Compression** (quality 80) - Simplifies similar colors
4. **Color Reduction** (64 colors) - Further color reduction
5. **Lossy Compression** (quality 60) - More aggressive compression
6. **Color Reduction** (32 colors) - Even fewer colors
7. **Lossy Compression** (quality 40) - Maximum lossy compression
8. **Frame Deduplication** (threshold 5) - Removes very similar frames
9. **Color Reduction** (16 colors) - Minimal color palette
10. **Frame Reduction** (70%) - Reduces frame count

The process stops when the target size is reached or all steps are completed.
